---
title: SpringBoot初入
date: 2020-03-19 11:44:01
tags: SpringBoot
---

# SpringBoot

## 主程序

```java
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

//来标注一个主程序类
@SpringBootApplication
public class DemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }

}
```

`@SpringBootApplication`: Spring Boot应用标注哪个类上，说明是主配置类，Spring Boot应该运行这个类的主方法来启动Spring Boot应用。

`@SpringBootConfiguration`：Spring Boot的配置类，标注在某个类上，表示这是个Spring Boot的配置类。

`@Configuration`：配置类上的来标注这个注解，配置类 ----  配置文件，配置类也是容器中的一个组件：`Component`

`@EnableAutoConfiguration`:开启自动配置的功能。

## 控制类Controller

```java
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
@Controller
public class HelloController {
    @ResponseBody
    @RequestMapping("/hello")
    public String hello(){
        return "Hello wrold";
    }
}
```

## 浏览器 

`http://localhost:8080/hello`

## 打成jar

由于目前使用的版本是2.2.5,所以不用再pom.xml引入jar包，直接可以打成jar包

## jar包的使用

使用命令`java  -jar  包名.jar`

## 配置文件

- application.properties
- application.yml

YAML配置例子

```
server:
	port:8080
```

XML配置例子

```
<server>
	<port>8080</port>
</server>
```

YAML语法

1.基本语法

k:(空格)v  表示一堆键值对(空格必须有)

空格的缩进来控制层级关系。

2.值的写法

字面量：普通的值(数值、字符串、布尔)

​	**字符串默认不加上单引号或者双引号**

对象、Map(属性和值)（键值对）

​	例子：

```yaml
friends:
	lastName: zhangsan
	age: 20
```

行内写法

```yacas
friends: {lastName: zhangsan,age: 20}
```

数组(List、Set):

用`-`表示数组中的一个元素

```yaml
pets:
	- cat
	- dog
	- pig
```

行内写法

```yaml
pets: [cat,dog,pig]
```

## 使用properties方法

在Bean类中封装好后加上`@Component`,然后再调用值的地方写入`@Value("${person.name}")`方法即可

properties配置文件

```
person.name=张三
```

使用如下：

```java
@Value("${person.name}")
private String name;
```



## 使用yaml方法

在Bean类中封装好后加上`@Component`以及`@ConfigurationProperties(prefix = "person")`，然后再yaml配置文件写入

```yaml
person:
  name: zhangsan1
  age: 20
  maps: {k1: v1,k2: v2}
  lists:
    - dog
    - pig
    - cat
```

然后再调用的地方写上`@Autowired`

使用如下：

```java
@Autowired
Person person;
person.getName();
```

即可

`@ConfigurationProperties`作用是可以批量注入。

## 注解使用

1.`@PropertySource`加载指定的配置文件

使用如下

```
@PropertySource(value={"classpath:文件名.properties"})
```

2.`@ImportResource`导入Spring的配置文件

使用如下

```
标注在配置类上
@ImportResource(locations={"classpath:配置文件名"})
```

推荐方式:(使用@Bean给容器中添加组件)

SpringBoot推荐给容器中添加主件，推荐使用全注解的方式

- 新建配置类config，且加上`@Configuration`注解

```java
@Configuration
public class Config{
    //将方法的返回值添加到容器中，容器中的组件默认就是id的方法名
    @Bean
    public HelloService helloService(){
        return new HelloService();
    }
}
```

## 配置文件占位符

- RandomValuePropertySource:配置文件中可以使用的随机数

```
app.description=${random.value}
app.description=${random.int}
app.description=${random.log}
app.description=${random.int(10)}
```

- 属性配置占位符

```
app.name=App
app.description=${app.name} is a Spring Boot
#如果没有app.name，将会报错。如果没出现app.name的话，也可以赋值使用
app.description=${app.name:This} is a Spring Boot
//This is a Spring Boot
```

## Profile

### 1.多个Profile文件

在编写配置文件的时候，文件名可以是 `application-{profile}.properties/yml`

默认是使用`application.properties`文件

### 2.激活指定profile

- 在默认配置文件中指定`spring.proflies.active={profile}`
- 命令行方式

```
  //可以再idea编辑器修改
  ---spring.profiles.active={profile}
  //或者打包使用时用该命令
  java -jar jar包名 --spring.profiles.active={profile}
```

- 虚拟机参数

```
-Dspring.profiles.active={profile}
```

### 3.yml支持多文档方式

```
service:
	port:8081
spring:
	profiles:
		active:dev
		
---
service:
	port:8082
spring:
	profiles:dev
	
---
service:
	port:8083
spring:
	profiles:prod
```

## 配置文件加载位置

1.优先从高到底，高优先级配置覆盖低的。

```
file: ./config/
file: ./
classpath: /config/
classpath: /
```

2.命令行参数

```
java -jar jar包名 --spring.config.location=D:/application.properties
```

## 外部配置加载顺序

1.命令行参数

```
java -jar jar包名 --server.port=8082
```

2.jar包外部寻找，外部优先于外部

- jar包外部的application-{profile}.properties或application.yml配置文件
  
## 日志框架

### 分类
- 日志门面(抽象层)
  - JCL、SLF4J、jboss-logging
- 日志实现
  - Log4J、JUL、Log4J2、Logback  

SpringBoot底层是Spring框架，Spring框架默认是JUL
SpringBoot选用SLF4J和logback

### SLF4J使用
```java

Logger logger=LoggerFactory.getLogger(XXXX.class);
logger.info("xxxxx")

```
### 日志的级别(由低到高)
Logger logger=LoggerFactory.getLogger(getClass());
- logger.trance("")
- logger.debug("")
- logger.info("")
- logger.warn("")
- logger.error("")
//SpingBoot默认输出info以下的，若要输出trance级别。需要在application里面配置
`logging.level.包名=trance`
//log文件保存的位置
`logging.file.name=路径`
//控制台输出的格式
`logger.pattern.console=`
