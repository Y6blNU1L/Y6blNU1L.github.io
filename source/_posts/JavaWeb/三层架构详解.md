---
title: 24.24三层架构详解
date: 2019-12-02 16:03:33
tags: JavaWeb
---

## 三层架构详解

三层架构与MVC设计模式的目标一致，都是为了解耦合、提高代码复用率。

区别是两者对项目的理解角度不同。

### 三层组成

- 表示层（USL,User，Show Layer；视图层）
  - 前台：对应于MVC中的View，用于和用户交互、界面的显示
  - 后台：对用于MVC中的Controller，用于控制跳转、调用业务逻辑层。
- 业务逻辑（BLL,Business，Logic，Layer；Service层）
  - 接收表示层的请求，调用。
  - 组装数据访问层，逻辑性操作。
- 数据访问层（DAL，Data Access Layer；  Dao层）
  - 直接访问数据库的操作，原子性操作。

![Qnjc6J.jpg](https://s2.ax1x.com/2019/12/02/Qnjc6J.jpg)

### 三层架构与MVC的关系

![QnjO0I.jpg](https://s2.ax1x.com/2019/12/02/QnjO0I.jpg)

### 步骤

![QuhB6K.jpg](https://s2.ax1x.com/2019/12/02/QuhB6K.jpg)

### add.jsp

```
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<form action="addStudentServlet" method="post">
		学号：<input type="text" name="sno" /></br>
		姓名：<input type="text" name="sname" /></br>
		年龄：<input type="password" name="sage" /></br>
		<input type="submit" value="增加" /></br>
	</form>

</body>
</html>
```

### addStudentServlet.java

```
public class addStudentServlet extends HttpServlet {
	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		int no=Integer.parseInt(request.getParameter("sno"));
		String name=request.getParameter("sname");
		int age=Integer.parseInt(request.getParameter("sage"));
		Student student =new Student(no,name,age);
		StudentService studentService=new StudentService();
		boolean result = studentService.addStudent(student);
		//设置编码
		response.setContentType("text/html;charset=UTF-8");
		response.setCharacterEncoding("utf-8");
		PrintWriter out=response.getWriter();
		if(result) {
			out.print("增加成功！");
		}else {
			out.print("增加失败！");
		}
		
	
	}

	
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		doGet(request, response);
	}

}
```

### Student.java

```
public class Student {
		private  int sno;
		private  String sname;
		private  int sage;		
		public Student() {
			
		}

		public Student(int sno, String sname, int sage) {
			super();
			this.sno = sno;
			this.sname = sname;
			this.sage = sage;
		}
		public int getSno() {
			return sno;
		}
		public void setSno(int sno) {
			this.sno = sno;
		}
		public String getSname() {
			return sname;
		}
		public void setSname(String sname) {
			this.sname = sname;
		}
		public int getSage() {
			return sage;
		}
		public void setSage(int sage) {
			this.sage = sage;
		}

```

### StudentDao.java

```
public class StudentDao {
	private static final String URL = "jdbc:mysql://localhost:3306/hba";
	private static final String USER = "root";
	private static final String PWD = "123456";

	//判断是否存在
	public boolean isExist(int sno) {
		return queryStudentBySno(sno) == null ? false : true;
	}
	//增加数据
	public boolean addStudent(Student student) {
		PreparedStatement pstmt = null;
		Connection connection = null;
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			connection = DriverManager.getConnection(URL, USER, PWD);
			// 查询数据库
			String sql = "insert into addstudent(sno,sname,sage) values(?,?,?) ";
			pstmt = connection.prepareStatement(sql);
			pstmt.setInt(1, student.getSno());
			pstmt.setString(2, student.getSname());
			pstmt.setInt(3, student.getSage());
			int count = pstmt.executeUpdate();
			if (count > 0) {
				return true;
			} else {
				return false;
			}

		} catch (ClassNotFoundException e) {
			e.printStackTrace();
			return false;
		} catch (SQLException e) {
			e.printStackTrace();
			return false;
		} catch (Exception e) {
			e.printStackTrace();
			return false;
		} finally {
			try {
				// 先开后关
				if (pstmt != null)
					pstmt.close();
				if (connection != null)
					connection.close();
			} catch (SQLException e) {
				e.printStackTrace();
			}
		}
	}

	// 根据学号 查询学生
	public Student queryStudentBySno(int sno) {
		Student student = null;
		PreparedStatement pstmt = null;
		Connection connection = null;
		ResultSet rs = null;
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			connection = DriverManager.getConnection(URL, USER, PWD);
			// 查询数据库
			String sql = "select * from addstudent where sno = ? ";
			pstmt = connection.prepareStatement(sql);
			pstmt.setInt(1, sno);
			rs = pstmt.executeQuery();
			if (rs.next()) {
				int no = rs.getInt("sno");
				String name = rs.getString("sname");
				int age = rs.getInt("sage");

				student = new Student(no, name, age);
			}
			return student;
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
			return null;
		} catch (SQLException e) {
			e.printStackTrace();
			return null;
		} catch (Exception e) {
			e.printStackTrace();
			return null;
		} finally {
			try {
				// 先开后关
				if (rs != null)
					rs.close();
				if (pstmt != null)
					pstmt.close();
				if (connection != null)
					connection.close();
			} catch (SQLException e) {
				e.printStackTrace();
			}
		}
	}
}

```

### StudentService.java

```
//业务逻辑层：逻辑性增删改查
public class StudentService {
	
	StudentDao studentDao=new StudentDao();
	public boolean addStudent(Student student) {
		if(!studentDao.isExist(student.getSno())) {
			studentDao.addStudent(student);
			return true;
		}else {
			System.out.println("此人存在！");
			return false;
		}
	}

}
```

