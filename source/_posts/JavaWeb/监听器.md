---
title: 43.43监听器
date: 2019-12-11 20:43:31
tags: JavaWeb
---

## 监听器

### 步骤

- 编写监听器，实现接口
- 配置web.xml

### 监听对象的创建和销毁

- request：ServletRequestListener
- session：HttpSessionListener
- application：ServletContextListener

每个监听器各自提供了2个方法：监听开始、监听结束的方法。

ServletContext在servlet容器启动时自动创建。

### 监听对象中属性的变更

- request：ServletRequestAttributeListener
- session：HttpSessionAttributeListener
- application：ServletContextAttributeListener

每个监听器各自提供了3个方法：监听开始、监听结束、监听替换的方法。

### ContextSessionRequestListener.java

```java
//实现监听器接口
public class ContextSessionRequestListener implements ServletRequestListener,HttpSessionListener,ServletContextListener {

	@Override
	public void contextDestroyed(ServletContextEvent sce) {
		System.out.println("监听ServerContext，销毁ServlerContext对象"+sce);
	}

	@Override
	public void contextInitialized(ServletContextEvent sce) {
		System.out.println("监听ServerContext，创建ServlerContext对象"+sce);
	}

	@Override
	public void sessionCreated(HttpSessionEvent se) {
		System.out.println("监听HttpSession，创建HttpSession对象"+se);
	}

	@Override
	public void sessionDestroyed(HttpSessionEvent se) {
		System.out.println("监听HttpSession，销毁HttpSession对象"+se);
	}

	@Override
	public void requestDestroyed(ServletRequestEvent sre) {
		System.out.println("监听ServletRequest，销毁ServletRequest对象"+sre);
	}

	@Override
	public void requestInitialized(ServletRequestEvent sre) {
		System.out.println("监听ServletRequest，创建ServletRequest对象"+sre);
	}

}
```

### sessionInvalidate.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<% 
		System.out.print("====session销毁页面=====");
		session.invalidate();
	%>
</body>
</html>
```

### AttributeListener.java

```java
public class AttributeListener implements ServletRequestAttributeListener,HttpSessionAttributeListener,ServletContextAttributeListener {
	
	@Override
	public void attributeAdded(ServletContextAttributeEvent scae) {
		//操作的属性名
		String attrName = scae.getName();
		Object attrValue = scae.getServletContext().getAttribute(attrName);
		System.out.println("ServletContext增加属性,属性名："+attrName+"属性值："+attrValue);
	}

	@Override
	public void attributeRemoved(ServletContextAttributeEvent scae) {
		System.out.println("ServletContext删除属性，属性名："+scae.getName());
	}

	@Override
	public void attributeReplaced(ServletContextAttributeEvent scae) {
		String attrName = scae.getName();
		Object attrValue = scae.getServletContext().getAttribute(attrName);
		System.out.println("ServletContext替换属性,属性名："+attrName+"属性值："+attrValue);
	}

	@Override
	public void attributeAdded(HttpSessionBindingEvent se) {
		//操作的属性名
		String attrName = se.getName();
		Object attrValue = se.getSession().getAttribute(attrName);
		System.out.println("HttpSession增加属性,属性名："+attrName+"属性值："+attrValue);
	}

	@Override
	public void attributeRemoved(HttpSessionBindingEvent se) {
		System.out.println("HttpSession删除属性，属性名："+se.getName());
	}

	@Override
	public void attributeReplaced(HttpSessionBindingEvent se) {
		String attrName = se.getName();
		Object attrValue = se.getSession().getAttribute(attrName);
		System.out.println("HttpSession替换属性,属性名："+attrName+"属性值："+attrValue);
	}

	@Override
	public void attributeAdded(ServletRequestAttributeEvent srae) {
		//操作的属性名
		String attrName = srae.getName();
		Object attrValue = srae.getServletRequest().getAttribute(attrName);
		System.out.println("ServletRequest增加属性,属性名："+attrName+"属性值："+attrValue);
	}

	@Override
	public void attributeRemoved(ServletRequestAttributeEvent srae) {
		System.out.println("ServletRequest删除属性，属性名："+srae.getName());
	}

	@Override
	public void attributeReplaced(ServletRequestAttributeEvent srae) {
		String attrName = srae.getName();
		Object attrValue = srae.getServletRequest().getAttribute(attrName);
		System.out.println("ServletRequest替换属性,属性名："+attrName+"属性值："+attrValue);
	}

}
```

### attribute.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<%
	application.setAttribute("name", "zs");//增加application属性
	application.setAttribute("name", "ls");//替换
	application.removeAttribute("name");//删除
	
	session.setAttribute("user", "user01");
	session.setAttribute("user", "user02");
	session.removeAttribute("user");
	
	request.setAttribute("school", "lq");
	request.setAttribute("school", "lq1");
	request.removeAttribute("school");
	%>
</body>
</html>
```

### web.xml

```
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" id="WebApp_ID" version="2.5">
  <display-name>UpAndDown</display-name>
  <!-- 配置监听器  -->
  <listener>
  	<listener-class>com.listener.ContextSessionRequestListener</listener-class>
  </listener>
 <!-- 属性监听器，启动下面这个时，上面那个要注释掉 -->
  <listener>
  	<listener-class>com.listener.AttributeListener</listener-class>
  </listener>
  
  <welcome-file-list>
    <welcome-file>index.html</welcome-file>
    <welcome-file>index.htm</welcome-file>
    <welcome-file>index.jsp</welcome-file>
    <welcome-file>default.html</welcome-file>
    <welcome-file>default.htm</welcome-file>
    <welcome-file>default.jsp</welcome-file>
  </welcome-file-list>
</web-app>
```

